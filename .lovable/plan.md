

# תוכנית: נורמליזציה של כפתורי "טען תבנית" ו"נקה" בכל הטאבים

## בעיות שזוהו

1. **פירוט שירותים (ServiceDetailsTab)**: חסר כפתור "נקה" לאיפוס רשימת השירותים
2. **תשלום (PaymentTermsTab)**: הטעינה האוטומטית לא עובדת -- התנאי `milestones.length === 0` נבדק כש-categoryId כבר מוגדר מראש, כך ש-`useEffect` לא מזהה שינוי. בנוסף, סדר הכפתורים הפוך: "נקה" מופיע מימין ל"טען תבנית" (ב-RTL), בעוד בשכ"ט הסדר הפוך
3. **שכ"ט (FeeItemsTable)**: עובד נכון -- זה הסטנדרט לחיקוי

## סטנדרט אחיד (לפי טאב שכ"ט)

כל טאב יציג את הכפתורים באותו מיקום ובאותו סדר:

```text
[כותרת הסקציה]                    [נקה] [טען תבנית]
```

- כותרת בצד ימין (RTL)
- כפתורי פעולה בצד שמאל: קודם "נקה" (ghost, מוצג רק כשיש פריטים), אח"כ "טען תבנית" (LoadTemplateButton)
- כפתור "נקה" זהה בסגנון: variant="ghost", size="sm", XCircle icon, text-xs, hover:text-destructive

## שינויים

### קובץ 1: `src/components/rfp/ServiceDetailsTab.tsx`

**הוספת כפתור "נקה"** ליד כפתור "טען תבנית" בכותרת ה-Collapsible של "רשימת שירותים":
- כפתור "נקה" שמבצע `onScopeItemsChange([])`
- מוצג רק כש-`scopeItems.length > 0`
- ממוקם לפני (שמאלית ל) כפתור "טען תבנית"

### קובץ 2: `src/components/rfp/PaymentTermsTab.tsx`

**תיקון 1 -- טעינה אוטומטית**: הבעיה היא שב-`useEffect` (שורה 146-155), הבדיקה `milestones.length === 0` מונעת טעינה כשכבר יש אבני דרך default מהרנדור הקודם, וגם ה-`prevCategoryIdRef` מאותחל ל-`undefined` ואז מקבל ערך בפעם הראשונה -- מה שמפעיל את הטעינה רק פעם אחת. כשמחליפים קטגוריה בטאב שירותים, ה-categoryId כבר משתנה לפני שנכנסים לטאב תשלום, כך שה-effect לא רץ שוב.

התיקון: להסיר את התנאי `milestones.length === 0` ולטעון תמיד כשה-categoryId משתנה (כמו שעובד ב-FeeItemsTable), תוך שימוש ב-`lastAutoLoadRef` כדי למנוע כפילות.

**תיקון 2 -- סדר כפתורים**: להחליף את סדר הכפתורים כך ש"נקה" יופיע ראשון (שמאלי יותר) ו"טען תבנית" אחרון (ימני יותר, קרוב יותר לכותרת) -- בדיוק כמו בטאב שכ"ט.

### סיכום קבצים

| קובץ | שינוי |
|-------|-------|
| `src/components/rfp/ServiceDetailsTab.tsx` | הוספת כפתור "נקה" ליד "טען תבנית" |
| `src/components/rfp/PaymentTermsTab.tsx` | תיקון auto-load + תיקון סדר כפתורים |

